<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>模型结果表格</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABnjsfBvYj6wHymnWiQpF5h1vSLe4j0os1kqYcV+VxN8Mdnd+HxOhjj" crossorigin="anonymous">
    <style>
        /* Add styles for data bars */
        .data-bar-cell {
            position: relative;
            padding-left: 15px;
            padding-right: 10px;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .data-bar {
            height: 5px;
            background-color: #007bff;
            position: absolute;
            bottom: 0;
            left: 0;
            transition: width 0.3s ease;
        }

        .badge {
            padding: 0.3em 0.6em;
            border-radius: 1em;
        }

        .badge-yes {
            background-color: #28a745;
            color: white;
        }

        .badge-no {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>

<body>

    <div class="container mt-5">
        <h2>模型结果表格</h2>

        <h3>LLM结果</h3>
        <table id="llm-res-table" class="table table-bordered">
            <thead></thead>
            <tbody></tbody>
        </table>

        <h3>VLM结果</h3>
        <table id="vlm-res-table" class="table table-bordered">
            <thead></thead>
            <tbody></tbody>
        </table>

        <h3>T2I结果</h3>
        <table id="t2i-res-table" class="table table-bordered">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // Function to load a single CSV file
        async function loadCSV(url) {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Failed to fetch CSV file from ${url}`);
            return await response.text();
        }

        // Function to calculate model column width dynamically
        function calculateModelColumnWidth(modelNames) {
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            tempDiv.style.visibility = 'hidden';
            tempDiv.style.whiteSpace = 'nowrap';
            document.body.appendChild(tempDiv);

            let maxWidth = 0;
            modelNames.forEach(name => {
                tempDiv.textContent = name;
                maxWidth = Math.max(maxWidth, tempDiv.offsetWidth);
            });

            document.body.removeChild(tempDiv);
            return maxWidth + 60;
        }

        // Function to process and render each table with data bars and consistent dimensions
        const processResultsTable = (data, tableId, headerClass) => {
            const table = document.getElementById(tableId);
            const tableHead = table.querySelector('thead');
            const tableBody = table.querySelector('tbody');

            if (!tableBody || !tableHead)
                throw new Error(`Table elements not found for ${tableId}`);

            tableHead.innerHTML = '';
            tableBody.innerHTML = '';

            const rows = data.trim().split('\n');
            const headers = rows[0].split(',').map(h => h.trim());

            // Log CSV data for debugging
            console.log(rows);

            const modelNames = rows.slice(1).map(row => row.split(',')[0].trim());
            const modelColumnWidth = calculateModelColumnWidth(modelNames);

            const tableWidth = table.clientWidth;
            const remainingWidth = tableWidth - modelColumnWidth;
            const otherColumnCount = headers.length - 1;
            const otherColumnWidth = Math.floor(remainingWidth / otherColumnCount);

            const headerRow = document.createElement('tr');
            headerRow.className = headerClass;
            headers.forEach((header, index) => {
                const th = document.createElement('th');
                th.textContent = header;

                th.style.width = index === 0 ? `${modelColumnWidth}px` : `${otherColumnWidth}px`;
                th.style.height = '50px';
                headerRow.appendChild(th);
            });
            tableHead.appendChild(headerRow);

            rows.slice(1).forEach(row => {
                const columns = row.split(',').map(col => col.trim());
                const tr = document.createElement('tr');
                const minValues = {
                    'llm-res-table': 50,
                    'vlm-res-table': 0,
                    't2i-res-table': 10
                };
                const min = minValues[tableId] || 0;
                const max = 100;

                columns.forEach((col, index) => {
                    const td = document.createElement('td');

                    if (headers[index] === 'Model') {
                        const modelDiv = document.createElement('div');
                        modelDiv.classList.add('data-bar-cell');
                        modelDiv.style.fontWeight = 'bold';
                        modelDiv.textContent = col || 'N/A';
                        td.appendChild(modelDiv);
                    } else if (!isNaN(col) && col !== '') {
                        const value = parseFloat(col).toFixed(2);

                        const cellDiv = document.createElement('div');
                        cellDiv.classList.add('data-bar-cell');

                        const textDiv = document.createElement('div');
                        textDiv.textContent = value;

                        const dataBar = document.createElement('div');
                        dataBar.classList.add('data-bar');
                        const widthPercentage = ((value - min) / (max - min)) * 100;
                        dataBar.style.width = `${Math.max(0, Math.min(100, widthPercentage))}%`;

                        cellDiv.appendChild(textDiv);
                        cellDiv.appendChild(dataBar);
                        td.appendChild(cellDiv);
                    } else {
                        const defaultDiv = document.createElement('div');
                        defaultDiv.classList.add('data-bar-cell');
                        defaultDiv.textContent = col || 'N/A';
                        td.appendChild(defaultDiv);
                    }
                    tr.appendChild(td);
                });

                tableBody.appendChild(tr);
            });
        };

        // Main function to load and render all tables
        async function loadTableData() {
            try {
                const [llmResults, vlmResults, t2iResults] = await Promise.all([
                    loadCSV('assets/data/llm-res.csv'),
                    loadCSV('assets/data/vlm-res.csv'),
                    loadCSV('assets/data/t2i-res.csv'),
                ]);

                processResultsTable(llmResults, 'llm-res-table', "table-primary");
                processResultsTable(vlmResults, 'vlm-res-table', "table-primary");
                processResultsTable(t2iResults, 't2i-res-table', "table-primary");
            } catch (error) {
                console.error('Error loading table data:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', loadTableData);
    </script>

</body>

</html>
